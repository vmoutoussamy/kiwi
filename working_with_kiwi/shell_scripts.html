

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Defined Scripts &mdash; kiwi 9.18.32 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Runtime Configuration File" href="runtime_configuration.html" />
    <link rel="prev" title="The Image Description" href="xml_description.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> kiwi
          

          
            
            <img src="../_static/kiwi-logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#before-you-start">Before you start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#choose-a-first-image">Choose a First Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#build-your-first-image">Build your First Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#run-your-image">Run your Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#tweak-and-customize-your-image">Tweak and Customize your Image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation-from-obs">Installation from OBS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation-from-your-distribution-s-repositories">Installation from your distribution’s repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation-from-pypi">Installation from PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#example-appliance-descriptions">Example Appliance Descriptions</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../working_with_kiwi.html">Working with KIWI</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml_description.html">The Image Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#the-image-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">image</span></code> Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#the-description-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">description</span></code> Element</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#the-preferences-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">preferences</span></code> Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="xml_description.html#build-types">Build Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#common-attributes-of-the-type-element">Common attributes of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">type</span></code> element</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xml_description.html#common-elements">Common Elements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#image-profiles">Image Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#adding-users">Adding Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml_description.html#defining-repositories-and-adding-or-removing-packages">Defining Repositories and Adding or Removing Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="xml_description.html#adding-repositories">Adding repositories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#supported-repository-paths">Supported repository paths</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xml_description.html#adding-and-removing-packages">Adding and removing packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#the-package-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">package</span></code> element</a></li>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#the-archive-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">archive</span></code> element</a></li>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#uninstall-system-packages">Uninstall System Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#the-product-and-namedcollection-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">product</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">namedCollection</span></code> element</a></li>
<li class="toctree-l4"><a class="reference internal" href="xml_description.html#the-ignore-element">The <code class="xref py py-obj docutils literal notranslate"><span class="pre">ignore</span></code> element</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">User Defined Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-customization-via-the-config-sh-shell-script">Image Customization via the <code class="docutils literal notranslate"><span class="pre">config.sh</span></code> Shell Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-tips">Configuration Tips</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#image-customization-via-the-images-sh-shell-script">Image Customization via the <code class="docutils literal notranslate"><span class="pre">images.sh</span></code> Shell Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-and-variables-provided-by-kiwi">Functions and Variables Provided by KIWI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#provided-functions">Provided Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#profile-environment-variables">Profile Environment Variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="runtime_configuration.html">The Runtime Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="customize_the_boot_process.html">Customizing the Boot Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="customize_the_boot_process.html#boot-image-hook-scripts">Boot Image Hook-Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="customize_the_boot_process.html#boot-image-parameters">Boot Image Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="customize_the_boot_process.html#boot-debugging">Boot Debugging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="legacy_kiwi.html">Legacy KIWI vs. Next Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="legacy_kiwi.html#when-do-i-need-to-use-the-legacy-kiwi">When Do I need to use the legacy kiwi</a></li>
<li class="toctree-l3"><a class="reference internal" href="legacy_kiwi.html#dropped-features">Dropped Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="legacy_kiwi.html#compatibility">Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_kiwi.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_kiwi.html#image-building-process">Image Building Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../working_with_kiwi.html#the-prepare-step">The Prepare Step</a></li>
<li class="toctree-l3"><a class="reference internal" href="../working_with_kiwi.html#the-create-step">The Create Step</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview/workflow.html">Basic Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/workflow.html#components-of-an-image-description">Components of an Image Description</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#conceptual-overview">Conceptual Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#system-requirements">System Requirements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../building.html">Building Images</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../building/build_live_iso.html">Build an ISO Hybrid Live Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_live_iso.html#decision-for-a-live-iso-technology">Decision for a live ISO technology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_vmx_disk.html">Build a Virtual Disk Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_vmx_disk.html#modifying-the-size-of-the-image">Modifying the Size of the Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_vmx_disk.html#customizing-the-virtual-machine">Customizing the Virtual Machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/build_vmx_disk.html#modifying-the-vm-configuration-directly">Modifying the VM Configuration Directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/build_vmx_disk.html#adding-network-interfaces-to-the-vm">Adding Network Interfaces to the VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/build_vmx_disk.html#specifying-disks-and-disk-controllers">Specifying Disks and Disk Controllers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/build_vmx_disk.html#adding-cd-dvd-drives">Adding CD/DVD Drives</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_oem_disk.html">Build an OEM Expandable Disk Image</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_oem_disk.html#deployment-methods">Deployment Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_oem_disk.html#manual-deployment">Manual Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_oem_disk.html#cd-dvd-deployment">CD/DVD Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_oem_disk.html#network-deployment">Network Deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_pxe_root_filesystem.html">Build a PXE Root File System Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_docker_container.html">Build a Docker Container Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_containerized.html">Building in a Self-Contained Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#installing-and-setting-up-dice">Installing and Setting up Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#installing-and-setting-up-docker">Installing and Setting up Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#installing-and-setting-up-the-build-container">Installing and Setting up the Build Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#installing-and-setting-up-vagrant">Installing and Setting up Vagrant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#configuring-dice">Configuring Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#selecting-a-kiwi-template">Selecting a KIWI Template</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#the-dicefile">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#building-with-dice">Building with Dice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#buildsystem-backends">Buildsystem Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#building-with-the-host-buildsystem">Building with the Host Buildsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#id1">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#building-with-the-vagrant-buildsystem">Building with the Vagrant Buildsystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#id2">The Dicefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#the-vagrant-setup-for-the-docker-provider">The Vagrant setup for the Docker Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#the-vagrantfile">The Vagrantfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#the-vagrant-setup-for-the-libvirt-provider">The Vagrant setup for the libvirt Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#the-vagrant-build-box">The Vagrant Build Box</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_containerized.html#id3">The Vagrantfile</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_with_profiles.html">Building Images with Profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_with_profiles.html#local-builds">Local Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_with_profiles.html#building-with-the-open-build-service">Building with the Open Build Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/build_in_buildservice.html">Building in the Open Build Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/build_in_buildservice.html#advantages-of-using-the-open-build-service-obs">Advantages of using the Open Build Service (OBS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_in_buildservice.html#differences-between-building-locally-and-on-obs">Differences Between Building Locally and on OBS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/build_in_buildservice.html#recommendations">Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/build_in_buildservice.html#working-with-obs">Working with OBS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/build_in_buildservice.html#repository-configuration">Repository Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/build_in_buildservice.html#project-configuration">Project Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building/working_with_images.html">Working with Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/iso_to_usb_stick_deployment.html">Deploy ISO Image on an USB Stick</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/iso_to_usb_stick_file_based_deployment.html">Deploy ISO Image as File on a FAT32 Formated USB Stick</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/vmx_setup_for_ec2.html">KIWI Image Description for Amazon EC2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/vmx_setup_for_azure.html">KIWI Image Description for Microsoft Azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/vmx_setup_for_google.html">KIWI Image Description for Google Compute Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/setup_pxe_bootserver.html">Setting Up a Network Boot Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/setup_pxe_bootserver.html#installing-and-configuring-atftp">Installing and Configuring atftp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/setup_pxe_bootserver.html#installing-and-configuring-dhcp">Installing and Configuring DHCP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/setup_yast_on_first_boot.html">Setting Up YaST at First Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html">PXE Client Setup Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-with-remote-root">Setup Client with Remote Root</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-with-system-on-local-disk">Setup Client with System on Local Disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-with-system-on-local-md-raid-disk">Setup Client with System on Local MD RAID Disk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-loading-of-custom-configuration-file-s">Setup Loading of Custom Configuration File(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-to-force-reload-image">Setup Client to Force Reload Image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-to-force-reload-configuration-files">Setup Client to Force Reload Configuration Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-client-for-reboot-after-deployment">Setup Client for Reboot After Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-custom-kernel-boot-options">Setup custom kernel boot options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-a-custom-boot-timeout">Setup a Custom Boot Timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/pxe_client_configuration.html#setup-a-different-download-protocol-and-server">Setup a Different Download Protocol and Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/vmx_vagrant_setup.html">KIWI Image Description for Vagrant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/vmx_vagrant_setup.html#customizing-the-embedded-vagrantfile">Customizing the embedded Vagrantfile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/pxe_live_iso_boot.html">Booting a Live ISO Image from Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/oem_ramdisk_deployment.html">Deploy and Run System in a RamDisk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/custom_partitions.html">Custom Disk Partitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../building/working_with_images/custom_partitions.html#custom-partitioning-at-boot-time">Custom Partitioning at Boot Time</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/custom_volumes.html">Custom Disk Volumes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/custom_fstab_extension.html">Add or Update the Fstab File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building/working_with_images/vmx_setup_for_luks.html">KIWI Image Description Encrypted Disk</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../building.html#supported-distributions">Supported Distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building.html#supported-platforms-and-architectures">Supported Platforms and Architectures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">KIWI Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/kiwi.html">kiwi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#global-options">GLOBAL OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#example">EXAMPLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#the-runtime-configuration-file">The Runtime Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/kiwi.html#compatibility">COMPATIBILITY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/result_list.html">kiwi result list</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_list.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/result_bundle.html">kiwi result bundle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/result_bundle.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_prepare.html">kiwi system prepare</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_prepare.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_update.html">kiwi system update</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_update.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_build.html">kiwi system build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#options">OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_build.html#uri-types">URI_TYPES</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/system_create.html">kiwi system create</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/system_create.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/image_resize.html">kiwi image resize</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_resize.html#options">OPTIONS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/image_info.html">kiwi image info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="../commands/image_info.html#options">OPTIONS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development and Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/kiwi_from_python.html">Using KIWI NG in a Python Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/api/kiwi.html">API Documentation 9.18.32</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.archive.html">kiwi.archive Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.boot.html">kiwi.boot Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.bootloader.html">kiwi.bootloader Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.builder.html">kiwi.builder Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.container.html">kiwi.container Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.filesystem.html">kiwi.filesystem Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.iso_tools.html">kiwi.iso_tools Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.package_manager.html">kiwi.package_manager Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.partitioner.html">kiwi.partitioner Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.repository.html">kiwi.repository Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.storage.html">kiwi.storage Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.system.html">kiwi.system Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.solver.html">kiwi.solver Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.tasks.html">kiwi.tasks package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.utils.html">kiwi.utils Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../development/api/kiwi.volume_manager.html">kiwi.volume_manager Package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.app"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.app</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.cli"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.cli</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.command"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.command</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.command_process"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.command_process</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.defaults"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.defaults</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.exceptions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.exceptions</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.firmware"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.firmware</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.help"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.help</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.kiwi"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.kiwi</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.logger"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.logger</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.mount_manager"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.mount_manager</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.path"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.path</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.privileges"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.privileges</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.runtime_checker"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.runtime_checker</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.runtime_config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.runtime_config</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.version"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.version</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.xml_description"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.xml_description</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi.xml_state"><code class="xref py py-obj docutils literal notranslate"><span class="pre">kiwi.xml_state</span></code> Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/api/kiwi.html#module-kiwi">Module Contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/schema.html">Schema Documentation 7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/schema_extensions.html">Extending KIWI with Custom Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#the-extension-section">The &lt;extension&gt; Section</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#relax-ng-schema-for-the-extension">RELAX NG Schema for the Extension</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#extension-schema-in-xml-catalog">Extension Schema in XML catalog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/schema_extensions.html#using-the-extension">Using the Extension</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#fork-the-upstream-kiwi-repository">Fork the upstream KIWI repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-local-clone-of-the-forked-kiwi-repository">Create a local clone of the forked KIWI repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#install-required-operating-system-packages">Install Required Operating System Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-python-virtual-development-environment">Create a Python Virtual Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#running-the-unit-tests">Running the Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#create-a-branch-for-each-feature-or-bugfix">Create a Branch for each Feature or Bugfix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#coding-style">Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development.html#additional-information">Additional Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development.html#signing-git-patches">Signing Git Patches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development.html#bumping-the-version">Bumping the Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development.html#creating-a-rpm-package">Creating a RPM Package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">kiwi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../working_with_kiwi.html">Working with KIWI</a> &raquo;</li>
        
      <li>User Defined Scripts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/working_with_kiwi/shell_scripts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-defined-scripts">
<span id="working-with-kiwi-user-defined-scripts"></span><h1>User Defined Scripts<a class="headerlink" href="#user-defined-scripts" title="Permalink to this headline">¶</a></h1>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p><strong>Abstract</strong></p>
<p>This chapter describes the usage of the user defined scripts
<code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> and <code class="file docutils literal notranslate"><span class="pre">image.sh</span></code>, which can be used to further
customize an image in ways that are not possible via the image
description alone.</p>
</div>
<p>KIWI supports up to two user defined scripts that it runs in the change
root environment (chroot) containing your new appliance:</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> runs the end of the <a class="reference internal" href="../working_with_kiwi.html#prepare-step"><span class="std std-ref">prepare step</span></a>
if present. It can be used to fine tune the unpacked image.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">images.sh</span></code> is executed at the beginning of the <a class="reference internal" href="../working_with_kiwi.html#create-step"><span class="std std-ref">image
creation process</span></a>. It is run on the top level of the
target root tree. The script is usually used to remove files that are
not needed in the final image. For example, if an appliance is being
built for a specific hardware, unnecessary kernel drivers can be removed
using this script.</p></li>
</ol>
<p>KIWI will execute both scripts via the operating system if their executable
bit is set (in that case a shebang is mandatory) otherwise they will be
invoked via the BASH.</p>
<div class="section" id="image-customization-via-the-config-sh-shell-script">
<span id="image-customization-config-sh"></span><h2>Image Customization via the <code class="docutils literal notranslate"><span class="pre">config.sh</span></code> Shell Script<a class="headerlink" href="#image-customization-via-the-config-sh-shell-script" title="Permalink to this headline">¶</a></h2>
<p>The KIWI image description allows to have an <code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> script in
place. It can be used for changes appropriate for all images to be created
from a given unpacked image (<code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> runs prior to the <em>create
step</em>). The script should add operating system configuration files which
would be otherwise added by a user driven installer, like the activation of
services, creation of configuration files, preparation of an environment
for a firstboot workflow, etc.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> script is called at the end of the <a class="reference internal" href="../working_with_kiwi.html#prepare-step"><span class="std std-ref">prepare step</span></a> (after users have been set and the <em>overlay tree directory</em>
has been applied). If <code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> exits with a non-zero exit code
then KIWI will report the failure and abort the image creation.</p>
<p>Find a common template for <code class="xref py py-obj docutils literal notranslate"><span class="pre">config.sh</span></code> script below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#======================================</span>
<span class="c1"># Include functions &amp; variables</span>
<span class="c1">#--------------------------------------</span>
<span class="nb">test</span> -f /.kconfig <span class="o">&amp;&amp;</span> . /.kconfig
<span class="nb">test</span> -f /.profile <span class="o">&amp;&amp;</span> . /.profile

<span class="c1">#======================================</span>
<span class="c1"># Greeting...</span>
<span class="c1">#--------------------------------------</span>
<span class="nb">echo</span> <span class="s2">&quot;Configure image: [</span><span class="nv">$kiwi_iname</span><span class="s2">]...&quot;</span>

<span class="c1">#======================================</span>
<span class="c1"># Call configuration code/functions</span>
<span class="c1">#--------------------------------------</span>
...
</pre></div>
</div>
<div class="section" id="configuration-tips">
<h3>Configuration Tips<a class="headerlink" href="#configuration-tips" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Stateless systemd UUIDs:</strong></p></li>
</ol>
<blockquote>
<div><p>Machine ID files are created and set (<code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code>,
<code class="file docutils literal notranslate"><span class="pre">/var/lib/dbus/machine-id</span></code>) during the image package installation
when <em>systemd</em> and/or <em>dbus</em> are installed. Those UUIDs are intended to
be unique and set only once in each deployment. KIWI follows the <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/machine-id.html">systemd
recommendations</a> and
wipes any <code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code> content, leaving it as an empty file.
Note, this only applies to images based on a dracut initrd, it does not
apply for container images.</p>
<p>In case this setting is also required for a non dracut based image,
the same result can achieved by removing <code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code> in
<code class="file docutils literal notranslate"><span class="pre">config.sh</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Avoid interactive boot</p>
<p>It is important to remark that the file <code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code> is set
to an empty file instead of deleting it. <strong class="command">systemd</strong> may
trigger <strong class="command">systemd-firstboot</strong> service if this file is not
present, which leads to an interactive firstboot where the user is
asked to provide some data.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Avoid inconsistent <code class="file docutils literal notranslate"><span class="pre">/var/lib/dbus/machine-id</span></code></p>
<p>Note that <code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code> and <code class="file docutils literal notranslate"><span class="pre">/var/lib/dbus/machine-id</span></code>
<strong>must</strong> contain the same unique ID. On modern systems
<code class="file docutils literal notranslate"><span class="pre">/var/lib/dbus/machine-id</span></code> is already a symlink to
<code class="file docutils literal notranslate"><span class="pre">/etc/machine-id</span></code>. However on older systems those might be two
different files. This is the case for SLE-12 based images. If you are
targeting these older operating systems, it is recommended to add the
symlink creation into <code class="file docutils literal notranslate"><span class="pre">config.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#======================================</span>
<span class="c1"># Make machine-id consistent with dbus</span>
<span class="c1">#--------------------------------------</span>
<span class="k">if</span> <span class="o">[</span> -e /var/lib/dbus/machine-id <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    rm /var/lib/dbus/machine-id
<span class="k">fi</span>
ln -s /etc/machine-id /var/lib/dbus/machine-id
</pre></div>
</div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="image-customization-via-the-images-sh-shell-script">
<span id="image-customization-images-sh"></span><h2>Image Customization via the <code class="docutils literal notranslate"><span class="pre">images.sh</span></code> Shell Script<a class="headerlink" href="#image-customization-via-the-images-sh-shell-script" title="Permalink to this headline">¶</a></h2>
<p>The KIWI image description allows to have an optional <code class="file docutils literal notranslate"><span class="pre">images.sh</span></code>
bash script in place. It can be used for changes appropriate for certain
images/image types on a case-by-case basis (since it runs at beginning of
<a class="reference internal" href="../working_with_kiwi.html#create-step"><span class="std std-ref">create step</span></a>).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Modifications of the unpacked root tree</p>
<p>Keep in mind that there is only one unpacked root tree the script
operates in. This means that all changes are permanent and will not be
automatically restored!</p>
</div>
<p>The script should be designed to take over control of handling image type
specific tasks. For example, if building the OEM type requires some
additional packages or configurations then that can be handled in
<code class="file docutils literal notranslate"><span class="pre">images.sh</span></code>. Additionally, the script authors tasks is to check if
changes performed beforehand do not interfere in a negative way if another
image type is created from the same unpacked image root tree.</p>
<p>If <code class="file docutils literal notranslate"><span class="pre">images.sh</span></code> exits with a non-zero exit code, then KIWI will report
an error and abort the image creation.</p>
<p>See below a common template for <code class="file docutils literal notranslate"><span class="pre">images.sh</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#======================================</span>
<span class="c1"># Include functions &amp; variables</span>
<span class="c1">#--------------------------------------</span>
<span class="nb">test</span> -f /.kconfig <span class="o">&amp;&amp;</span> . /.kconfig
<span class="nb">test</span> -f /.profile <span class="o">&amp;&amp;</span> . /.profile

<span class="c1">#======================================</span>
<span class="c1"># Greeting...</span>
<span class="c1">#--------------------------------------</span>
<span class="nb">echo</span> <span class="s2">&quot;Configure image: [</span><span class="nv">$kiwi_iname</span><span class="s2">]...&quot;</span>

<span class="c1">#======================================</span>
<span class="c1"># Call configuration code/functions</span>
<span class="c1">#--------------------------------------</span>
...

<span class="c1">#======================================</span>
<span class="c1"># Exit successfully</span>
<span class="c1">#--------------------------------------</span>
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="section" id="functions-and-variables-provided-by-kiwi">
<h2>Functions and Variables Provided by KIWI<a class="headerlink" href="#functions-and-variables-provided-by-kiwi" title="Permalink to this headline">¶</a></h2>
<p>KIWI creates the <code class="file docutils literal notranslate"><span class="pre">.kconfig</span></code> and <code class="file docutils literal notranslate"><span class="pre">.profile</span></code> files to be sourced
by the shell scripts <code class="file docutils literal notranslate"><span class="pre">config.sh</span></code> and <code class="file docutils literal notranslate"><span class="pre">images.sh</span></code>.
<code class="file docutils literal notranslate"><span class="pre">.kconfig</span></code> contains various helper functions which can be used to
simplify the image configuration and <code class="file docutils literal notranslate"><span class="pre">.profile</span></code> contains environment
variables which get populated from the settings provided in the image
description.</p>
<div class="section" id="provided-functions">
<h3>Provided Functions<a class="headerlink" href="#provided-functions" title="Permalink to this headline">¶</a></h3>
<p>The <code class="file docutils literal notranslate"><span class="pre">.kconfig</span></code> file provides a common set of functions.  Functions
specific to SUSE Linux begin with the name <code class="docutils literal notranslate"><span class="pre">suse</span></code>, functions applicable
to all Linux distributions start with the name <code class="docutils literal notranslate"><span class="pre">base</span></code>.</p>
<p>The following list describes all functions provided by <code class="file docutils literal notranslate"><span class="pre">.kconfig</span></code>:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">baseCleanMount</span></code></dt><dd><p>Unmount the filesystems <code class="file docutils literal notranslate"><span class="pre">/proc</span></code>, <code class="file docutils literal notranslate"><span class="pre">/dev/pts</span></code>, <code class="file docutils literal notranslate"><span class="pre">/sys</span></code> and
<code class="file docutils literal notranslate"><span class="pre">/proc/sys/fs/binfmt_misc</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseGetPackagesForDeletion</span></code></dt><dd><p>Return the name(s) of the packages marked for deletion in the image
description.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseGetProfilesUsed</span></code></dt><dd><p>Return the name(s) of profiles used to build this image.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseSetRunlevel</span> <span class="pre">{value}</span></code></dt><dd><p>Set the default run level.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseSetupUserPermissions</span></code></dt><dd><p>Set the ownership of all home directories and their content to the correct
users and groups listed in <code class="file docutils literal notranslate"><span class="pre">/etc/passwd</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripAndKeep</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">info-files</span> <span class="pre">to</span> <span class="pre">keep}</span></code></dt><dd><p>Helper function for the <code class="docutils literal notranslate"><span class="pre">baseStrip*</span></code> functions, reads the list of files
to check from stdin for removing
params: files which should be kept</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripDocs</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">docu</span> <span class="pre">names</span> <span class="pre">to</span> <span class="pre">keep}</span></code></dt><dd><p>Remove all documentation files, except for the ones given as the
parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripInfos</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">info-files</span> <span class="pre">to</span> <span class="pre">keep}</span></code></dt><dd><p>Remove all info files, except for the one given as the parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripLocales</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">locales}</span></code></dt><dd><p>Remove all locales, except for the ones given as the parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripTranslations</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">translations}</span></code></dt><dd><p>Remove all translations, except for the ones given as the parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripMans</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">manpages</span> <span class="pre">to</span> <span class="pre">keep}</span></code></dt><dd><p>Remove all manual pages, except for the ones given as the parameter.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>baseStripMans more less
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseImportBuildKey</span></code></dt><dd><p>Add the SUSE build keys to the RPM database.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripUnusedLibs</span></code></dt><dd><p>Remove libraries which are not directly linked against applications
in the bin directories.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseUpdateSysConfig</span> <span class="pre">{filename}</span> <span class="pre">{variable}</span> <span class="pre">{value}</span></code></dt><dd><p>Update the contents of a sysconfig variable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseConfig</span></code></dt><dd><p>This function is deprecated and is a NOP.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseSystemdServiceInstalled</span> <span class="pre">{service}</span></code></dt><dd><p>Prints the path of the first found systemd unit or mount with name passed
as the first parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseSysVServiceInstalled</span> <span class="pre">{service}</span></code></dt><dd><p>Prints the name <code class="xref py py-obj docutils literal notranslate"><span class="pre">${service}</span></code> if a SysV init service with that name is
found, otherwise it prints nothing.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseSystemdCall</span> <span class="pre">{service_name}</span> <span class="pre">{args}</span></code></dt><dd><p>Calls <code class="xref py py-obj docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">${args}</span> <span class="pre">${service_name}</span></code> if a systemd unit, a systemd
mount or a SysV init service with the <code class="xref py py-obj docutils literal notranslate"><span class="pre">${service_name}</span></code> exist.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseInsertService</span> <span class="pre">{servicename}</span></code></dt><dd><p>Activate the given service via <strong class="command">systemctl</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseRemoveService</span> <span class="pre">{servicename}</span></code></dt><dd><p>Deactivate the given service via <strong class="command">systemctl</strong>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseService</span> <span class="pre">{servicename}</span> <span class="pre">{on|off}</span></code></dt><dd><p>Activate or deactivate a service via <strong class="command">systemctl</strong>.
The function requires the service name and the value <code class="docutils literal notranslate"><span class="pre">on</span></code> or <code class="docutils literal notranslate"><span class="pre">off</span></code> as
parameters.</p>
<p>Example to enable the sshd service on boot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>baseService sshd on
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseInsertService</span> <span class="pre">{servicename}</span></code></dt><dd><p>Calls baseInsertService and exists only for
compatibility reasons.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseRemoveService</span> <span class="pre">{servicename}</span></code></dt><dd><p>Calls baseRemoveService and exists only for
compatibility reasons.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseService</span> <span class="pre">{servicename}</span> <span class="pre">{on|off}</span></code></dt><dd><p>Calls baseService and exists only for compatibility
reasons.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseActivateDefaultServices</span></code></dt><dd><p>Activates the <code class="xref py py-obj docutils literal notranslate"><span class="pre">network</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">cron</span></code> services to run at boot.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseSetupProduct</span></code></dt><dd><p>Creates the <code class="file docutils literal notranslate"><span class="pre">/etc/products.d/baseproduct</span></code> link
pointing to the product referenced by either <code class="file docutils literal notranslate"><span class="pre">/etc/SuSE-brand</span></code> or
<code class="file docutils literal notranslate"><span class="pre">/etc/os-release</span></code> or the latest <code class="xref py py-obj docutils literal notranslate"><span class="pre">prod</span></code> file available in
<code class="file docutils literal notranslate"><span class="pre">/etc/products.d</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseSetupProductInformation</span></code></dt><dd><p>Uses <strong class="command">zypper</strong> to search for the installed product
and installs all product specific packages. This function fails
when <strong class="command">zypper</strong> is not the appliances package manager.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Debug</span> <span class="pre">{message}</span></code></dt><dd><p>Helper function to print the supplied message if the variable DEBUG is
set to 1.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Echo</span> <span class="pre">{echo</span> <span class="pre">commandline}</span></code></dt><dd><p>Helper function to print a message to the controlling terminal.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Rm</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">files}</span></code></dt><dd><p>Helper function to delete files and log the deletion.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Rpm</span> <span class="pre">{rpm</span> <span class="pre">commandline}</span></code></dt><dd><p>Helper function for calling <code class="docutils literal notranslate"><span class="pre">rpm</span></code>: forwards all commandline arguments to
<code class="docutils literal notranslate"><span class="pre">rpm</span></code> and logs the call.</p>
</dd>
</dl>
<div class="section" id="functions-for-custom-non-dracut-based-boot">
<h4>Functions for Custom non-dracut Based Boot<a class="headerlink" href="#functions-for-custom-non-dracut-based-boot" title="Permalink to this headline">¶</a></h4>
<p>KIWI also provides the following functions (mostly for compatibility
reasons) which can be used to customize the boot process when using the
custom boot option (see
<a class="reference internal" href="customize_the_boot_process.html#working-with-kiwi-customizing-the-boot-process"><span class="std std-ref">Customizing the Boot Process</span></a>):</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">baseStripInitrd</span></code></dt><dd><p>Removes various tools binaries and libraries which
are not required to boot a SUSE system with KIWI. This function is not
required when using the dracut initrd system and is kept for
compatibility reasons.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripFirmware</span></code></dt><dd><p>Check all kernel modules if they require a firmware and strip out all
firmware files which are not referenced by a kernel module</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripModules</span></code></dt><dd><p>Search for updated modules and remove the old version which might be
provided by the standard kernel</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripKernel</span></code></dt><dd><p>Strips the kernel:</p>
<ol class="arabic simple">
<li><p>create the <code class="file docutils literal notranslate"><span class="pre">vmlinux.gz</span></code> and <code class="file docutils literal notranslate"><span class="pre">vmlinuz</span></code> files which are used
as a fallback for the kernel extraction</p></li>
<li><p>handle <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;strip</span> <span class="pre">type=&quot;delete&quot;&gt;</span></code> requests. Because this information is
generic not only files of the kernel are affected but also other data
which are unwanted get deleted here</p></li>
<li><p>only keep kernel modules matching the <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;drivers&gt;</span></code> patterns from the
kiwi boot image description</p></li>
<li><p>lookup kernel module dependencies and bring back modules which were
removed but still required by other modules that were kept in the
system</p></li>
<li><p>search for duplicate kernel modules due to kernel module updates and
keep only the latest version</p></li>
<li><p>search for kernel firmware files and keep only those for which a
kernel driver is still present in the system</p></li>
</ol>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">suseStripKernel</span></code></dt><dd><p>Removes all kernel drivers which are not listed in the
drivers sections of <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseStripTools</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">toolpath}</span> <span class="pre">{list</span> <span class="pre">of</span> <span class="pre">tools}</span></code></dt><dd><p>Helper function for suseStripInitrd
function parameters: toolpath, tools.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="profile-environment-variables">
<h3>Profile Environment Variables<a class="headerlink" href="#profile-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>The <code class="file docutils literal notranslate"><span class="pre">.profile</span></code> environment file is created by KIWI and contains a
specific set of variables which are listed below.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_compressed</span></code></dt><dd><p>The value of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">compressed</span></code> attribute set in the <a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">type</span></code></a> element in
<code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_delete</span></code></dt><dd><p>A list of all packages which are children of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">packages</span></code> element
with <code class="xref py py-obj docutils literal notranslate"><span class="pre">type=&quot;delete&quot;</span></code> in <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_drivers</span></code></dt><dd><p>A comma separated list of the driver entries as listed in the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">drivers</span></code> section of the <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_iname</span></code></dt><dd><p>The name of the image as listed in <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_iversion</span></code></dt><dd><p>The image version as a string.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_keytable</span></code></dt><dd><p>The contents of the keytable setup as done in <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_language</span></code></dt><dd><p>The contents of the locale setup as done in <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_profiles</span></code></dt><dd><p>A comma separated list of profiles used to build this image.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_timezone</span></code></dt><dd><p>The contents of the timezone setup as done in <code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">$kiwi_type</span></code></dt><dd><p>The image type as extracted from the <a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">type</span></code></a> element in
<code class="file docutils literal notranslate"><span class="pre">config.xml</span></code>.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="runtime_configuration.html" class="btn btn-neutral float-right" title="The Runtime Configuration File" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="xml_description.html" class="btn btn-neutral float-left" title="The Image Description" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Marcus Schäfer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>